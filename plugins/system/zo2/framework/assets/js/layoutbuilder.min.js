(function(w,z,$){var _layoutbuilder={_elements:{layoutBuilderContainer:'#layoutbuilder-container > #zo2-layoutbuilder',childrenContainer:'.children-container',sortableConnect:'.connectedSortable',sortableRow:'.sortable-row',joomlaTooltip:'.tooltip',emptyParentRow:'#zo2-empty-parent-row',emptyChildRow:'#zo2-empty-child-row'},layoutJson:null,_init:function(){var _self=this;$(_self._elements.childrenContainer).sortable({placeholder:"sortable-hightligth",start:function(event,ui){ui.placeholder.height(ui.helper.outerHeight());ui.placeholder.addClass(ui.item.attr('class'));},stop:function(event,ui){ui.placeholder.removeClass(ui.item.attr('class'));},connectWith:_self._elements.sortableConnect}).disableSelection();$(_self._elements.layoutBuilderContainer).sortable({placeholder:"sortable-hightligth",start:function(event,ui){ui.placeholder.height(ui.helper.outerHeight());ui.placeholder.addClass(ui.item.attr('class'));},stop:function(event,ui){ui.placeholder.removeClass(ui.item.attr('class'));}}).disableSelection();},sortableFlush:function(){$(this._elements.layoutBuilderContainer).sortable("destroy");$(this._elements.childrenContainer).sortable("destroy");},getLayoutJson:function(){this.layoutJson=[];this._getLayoutJson();return this.layoutJson;},addParentRow:function(){this.sortableFlush();$(this._elements.layoutBuilderContainer).find(this._elements.sortableRow+':first').before($(this._elements.emptyParentRow).html());this._init();},addRow:function(element){this.sortableFlush();var $childContainer=$(element).closest(this._elements.sortableRow).find(this._elements.childrenContainer+':first');if($childContainer.find(this._elements.sortableRow).length>0){$childContainer.find(this._elements.sortableRow+':first').before($(this._elements.emptyChildRow).html());}else{$childContainer.html($(this._elements.emptyChildRow).html());}
this._init();},deleteRow:function(element){$(element).closest(this._elements.sortableRow).remove();$(this._elements.joomlaTooltip).find(':visible').hide();},_getLayoutJson:function($node,parent){var _self=this;if(typeof($node)=='undefined'){$node=$(_self._elements.layoutBuilderContainer);parent=_self.layoutJson;}else{$node=$node.find(_self._elements.childrenContainer+':first');}
$.each($node.children(_self._elements.sortableRow),function(){if(typeof($(this).data('zo2'))!='undefined'){parent.push($(this).data('zo2'));parent[parent.length-1].children=[];_self._getLayoutJson($(this),parent[parent.length-1].children);}});}};z.layoutbuilder=_layoutbuilder;$(w.document).ready(function(){z.layoutbuilder._init();});})(window,zo2,jQuery);